#from pandas import DataFrame
#import numpy as np
#import json
import pandas as pd
import ast

def order_opcode_list(df):
    ordered_opcodes_lists = []
    contador = 0
    for array in df['objdump']:
        opcodes_dict = ast.literal_eval(array)['opcodes_objdump']
        opcodes_dict_keys = list(int(x) for x in opcodes_dict.keys())
        opcodes_dict_keys.sort()
        sorted_opcodes_dict = {i: opcodes_dict[str(i)] for i in opcodes_dict_keys}
        ordered_opcodes_list = []
        for op_k in sorted_opcodes_dict:
            ordered_opcodes_list.append(sorted_opcodes_dict[op_k])
        ordered_opcodes_lists.append(' '.join(ordered_opcodes_list))
        contador +=1
        if(contador%100 == 0):
            print(contador)

    ordered_opcodes_series = pd.Series(ordered_opcodes_lists)
    df['opcodes_objdump_ordered']  = ordered_opcodes_series
    return df.drop(['objdump'], axis=1)

csv_training_path = '/media/cuckoohost/HD/OneDrive/AndreViana/Documents/0 USP/2023.1/TCC/Codigos/csvs/objdump/objdump{}.csv'
training_samples_df_list = []

csv_test_path = '/media/cuckoohost/HD/OneDrive/AndreViana/Documents/0 USP/2023.1/TCC/Codigos/csvs/objdump/objdump{}_test.csv'
test_samples_df_list = []

for i in range(6):
        this_df = pd.read_csv(csv_training_path.format(i))
        training_samples_df_list.append(this_df)

for i in range(6):
        this_df = pd.read_csv(csv_test_path.format(i))
        test_samples_df_list.append(this_df)

#combinando em um DF
df_train = pd.concat(training_samples_df_list, ignore_index=True)
df_test = pd.concat(test_samples_df_list, ignore_index=True)

df_train = order_opcode_list(df_train)
df_test = order_opcode_list(df_test)

df_train.to_csv('/media/cuckoohost/HD/OneDrive/AndreViana/Documents/0 USP/2023.1/TCC/Codigos/csvs/objdump/objdump_preprocessed.csv', index=False)
df_test.to_csv('/media/cuckoohost/HD/OneDrive/AndreViana/Documents/0 USP/2023.1/TCC/Codigos/csvs/objdump/objdump_preprocessed_test.csv', index=False)